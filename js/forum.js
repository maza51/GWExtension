function getXmlHttp(){var xmlhttp; try {xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");} catch (e) { try {xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");} catch (E) { xmlhttp = false;}} if (!xmlhttp && typeof XMLHttpRequest!='undefined') {xmlhttp = new XMLHttpRequest();} return xmlhttp;}WP = widget.preferences;document.addEventListener("DOMContentLoaded", function() {		window.getforum = function () {				document.getElementById('infoleft').style.display = 'table-cell';		document.getElementById('info').style.display = 'none';				var cb_oi = document.getElementById('oi');		var cb_ok = document.getElementById('ok');		var cb_kr = document.getElementById('kr');		cb_oi.onclick = function() { if (this.checked) { WP.forum='oi'; this.disabled = true; cb_ok.disabled = false; cb_ok.checked = false; cb_kr.disabled = false; cb_kr.checked = false; } }		cb_ok.onclick = function() { if (this.checked) { WP.forum='ok'; this.disabled = true; cb_oi.disabled = false; cb_oi.checked = false; cb_kr.disabled = false; cb_kr.checked = false; } }		cb_kr.onclick = function() { if (this.checked) { WP.forum='kr'; this.disabled = true; cb_oi.disabled = false; cb_oi.checked = false; cb_ok.disabled = false; cb_ok.checked = false; } }				if (WP.forum == 'oi') { cb_oi.checked = true; cb_oi.disabled = true; }		if (WP.forum == 'ok') { cb_ok.checked = true; cb_ok.disabled = true; }		if (WP.forum == 'kr') { cb_kr.checked = true; cb_kr.disabled = true; }				var stage = 0;		var ty;		var tu;				window.go = function (param) {						var link = 'forum='+WP.forum+'&';						if (param == 1) {				if (!ty && stage == 0) ty = document.getElementById('param1').value;				if (ty != '') { link += 'tema='+urlEncode(ty)+'&'; }								if (!tu && stage == 0) tu = document.getElementById('param2').value;				if (!ty) { link += 'nick='+urlEncode(tu); }				else { if (tu != '') link += 'nick='+urlEncode(tu); }								if (stage > 0) link += '&param='+(stage*23);			}			else if (param == 2) { link += 'dubl=best'; if (stage > 0) link += '&param='+(stage*23); }			else if (param == 3) { link += 'dubl=bad'; if (stage > 0) link += '&param='+(stage*23); }			else if (param == 4) { link += 'dubl=bestall'; if (stage > 0) link += '&param='+(stage*23); }			else if (param == 5) { link += 'dubl=badall'; if (stage > 0) link += '&param='+(stage*23); }						var tmp_span = document.createElement('span');						document.body.bgColor = '#f5fff5';			if (stage == 0) opera.extension.bgProcess.doHeight(23+26);			opera.extension.bgProcess.doWidth(430);			var post = document.getElementById('post');			if (post) post.outerHTML = '<table id="theme" style="border-left: 1px #339933 solid; border-right: 1px #339933 solid;"></table>';						stage++;						var r = getXmlHttp();			r.open('GET', 'http://vodkapower.ru/gw/searchforum.php?'+link, true);			r.onreadystatechange = function() {				if (r.readyState == 4) {					if(r.status == 200) {						if (!r.responseText) {							var tr = document.createElement('tr');							var td = document.createElement('td');							td.style.width = '420px';							var nobr = document.createElement('nobr');							nobr.innerHTML = 'Ничего не найдено...';							td.appendChild(nobr);							tr.appendChild(td);							document.getElementById('theme').appendChild(tr);						}						var txt = r.responseText.match(/<div>(.*)<\/div>/i)[1];						txt = txt.split('<br>');						var count = txt.length-1;						for (i = 0; i < count; i++) {							if (stage == 1) opera.extension.bgProcess.doHeight((i+(count>=23?1:0))*23+26);														var tmp = txt[i].match(/<li>(.*)<\/li>/i)[1].split(' | ');														var tr = document.createElement('tr');							var td = document.createElement('td');							td.title = tmp[1];							td.style.height = '18px';							param<4?(td.style.width = '220px'):(td.style.width = '32px');							//td.style.width = '220px';							var nobr = document.createElement('nobr');							var a = document.createElement('a');							a.target = "_blank";							a.href = "http://www.ganjawars.ru/messages.php"+tmp[0];							a.style.textDecoration = "none";							a.style.padding = "1px 0.2em";							a.style.fontSize = "8pt";							a.innerHTML = tmp[1];							nobr.appendChild(a);							td.appendChild(nobr);							tr.appendChild(td);														td = document.createElement('td');							td.style.height = '18px';							param<4?(td.style.width = '34px'):(td.style.width = '134px');							//td.style.width = '34px';							td.style.textAlign = "center";							nobr = document.createElement('nobr');							var font = document.createElement('font');							font.style.fontSize = "6pt";							font.style.fontFamily = '"verdana", "geneva", "arial cyr", "arial", "helvetica", sans-serif';							if (tmp[4] > 0) font.style.color = "#58A35D";							else font.style.color = "#9E3A3A";							font.style.padding = "1px 0.0em";							if (tmp[4] != '0') tmp[4]>0?(font.innerHTML = '+'+tmp[4]):(font.innerHTML = tmp[4])							nobr.appendChild(font);							td.appendChild(nobr);							tr.appendChild(td);														td = document.createElement('td');							td.title = tmp[2];							td.style.height = '18px';							param<4?(td.style.width = '110px'):(td.style.width = '198px');							//td.style.width = '110px';							nobr = document.createElement('nobr');							a = document.createElement('a');							a.style.padding = "1px 0.1em";							a.style.fontSize = "9pt";							a.target = "_blank";							a.href = "http://www.ganjawars.ru/search.php?key="+urlEncode(tmp[2]);							a.innerHTML = tmp[2];							a.style.color = "#19331B";							nobr.appendChild(a);							td.appendChild(nobr);							tr.appendChild(td);														td = document.createElement('td');							td.style.height = '18px';							td.style.width = '32px';							nobr = document.createElement('nobr');							font = document.createElement('font');							font.title = tmp[3];							font.style.fontSize = "6pt";							font.style.padding = "1px 0.1em";							font.style.color = "#004400";							font.innerHTML = tmp[3].slice(2,10);							nobr.appendChild(font);							td.appendChild(nobr);							tr.appendChild(td);														document.getElementById('theme').appendChild(tr);						}						if (count >= 23) {							var tr = document.createElement('tr');							var td = document.createElement('td');							var b = document.createElement('b');							var a = document.createElement('a');							td.style.cursor = 'pointer';							td.style.height = '18px';							td.style.width = '402px';							td.style.textAlign = 'center';							td.onclick = function() { go(param); }							b.innerHTML = 'Дальше';							a.appendChild(b);							td.appendChild(a);							tr.appendChild(td);							document.getElementById('theme').appendChild(tr);						}					}				}			};			r.send(null);		}			}}, false);function urlEncode(str) {	if (!str || typeof(str) == "undefined") return; 	var utf8Array = {}; 	var i = j = j2 = 0; 	for (i = 0; i <= 255; i++) { 		j = parseInt(i/16); var j2 = parseInt(i%16); 		utf8Array[String.fromCharCode(i)] = (			'%' + 			j.toString(16) +			j2.toString(16)		).toUpperCase(); 	} 	var rusAdditional = {		'_' : '%5F', 'А' : '%C0', 'Б' : '%C1', 'В' : '%C2',		'Г' : '%C3', 'Д' : '%C4', 'Е' : '%C5', 		'Ж' : '%C6', 'З' : '%C7', 'И' : '%C8', 'Й' : '%C9',		'К' : '%CA', 'Л' : '%CB', 'М' : '%CC', 		'Н' : '%CD', 'О' : '%CE', 'П' : '%CF', 'Р' : '%D0',		'С' : '%D1', 'Т' : '%D2', 'У' : '%D3', 		'Ф' : '%D4', 'Х' : '%D5', 'Ц' : '%D6', 'Ч' : '%D7',		'Ш' : '%D8', 'Щ' : '%D9', 'Ъ' : '%DA', 		'Ы' : '%DB', 'Ь' : '%DC', 'Э' : '%DD', 'Ю' : '%DE',		'Я' : '%DF', 'а' : '%E0', 'б' : '%E1', 		'в' : '%E2', 'г' : '%E3', 'д' : '%E4', 'е' : '%E5',		'ж' :'%E6', 'з' : '%E7', 'и' : '%E8', 		'й' : '%E9', 'к' : '%EA', 'л' : '%EB', 'м' : '%EC',		'н' : '%ED', 'о' : '%EE', 'п' : '%EF', 		'р' : '%F0', 'с' : '%F1', 'т' : '%F2', 'у' : '%F3',		'ф' : '%F4', 'х' : '%F5', 'ц' : '%F6', 		'ч' : '%F7', 'ш' : '%F8', 'щ' : '%F9', 'ъ' : '%FA',		'ы' : '%FB', 'ь' : '%FC', 'э' : '%FD', 		'ю' : '%FE', 'я' : '%FF', 'ё' : '%B8', 'Ё' : '%A8' 	} 	for (i in rusAdditional) utf8Array[i] = rusAdditional[i]; 	var res = ""; 	for(i = 0; i < str.length; i++) { 		var simbol = str.substr(i,1); 		res += typeof utf8Array[simbol] != "undefined" 			? utf8Array[simbol] 			: simbol; 	} 	res = res.replace(/\s/g, "+"); 	return res; }